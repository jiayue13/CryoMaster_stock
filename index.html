<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryoMaster Stock View</title>
    <style>
        :root { --bg: #f5f7fa; --card: #ffffff; --primary: #1967D2; --text: #202124; --border: #dadce0; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 12px; }
        .container { max-width: 600px; margin: 0 auto; }
        
        /* é¡¶éƒ¨ç›’å­ä¿¡æ¯å¡ç‰‡ */
        .card { background: var(--card); border-radius: 12px; padding: 16px; margin-bottom: 12px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); border: 1px solid var(--border); }
        .header h1 { margin: 0; font-size: 1.25rem; color: var(--primary); display: flex; align-items: center; gap: 8px; }
        .header .meta { font-size: 0.85rem; color: #5f6368; margin-top: 4px; }
        .stat-bar { height: 4px; background: #f1f3f4; border-radius: 2px; margin-top: 12px; overflow: hidden; }
        .stat-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.5s; }

        /* åˆ—è¡¨åŒºåŸŸ */
        .list-title { font-size: 0.9rem; font-weight: 700; color: #5f6368; margin: 20px 0 8px 4px; text-transform: uppercase; letter-spacing: 0.5px; }
        
        /* === [æ ¸å¿ƒ] åç‰‡å¼åˆ—è¡¨é¡¹æ ·å¼ === */
        .list-item { 
            background: var(--card);
            border-radius: 8px;
            padding: 14px;
            margin-bottom: 10px;
            border: 1px solid var(--border);
            box-shadow: 0 1px 2px rgba(0,0,0,0.02);
            display: flex;
            flex-direction: column;
            gap: 6px; /* è¡Œé—´è· */
        }
        
        /* ç¬¬ä¸€è¡Œï¼šåæ ‡ + åç§° + çŠ¶æ€ */
        .row-top { display: flex; justify-content: space-between; align-items: center; }
        .coord-badge { 
            font-family: monospace; font-weight: 700; font-size: 0.95rem; 
            color: var(--primary); background: #e8f0fe; 
            padding: 2px 6px; border-radius: 4px; margin-right: 8px;
        }
        .sample-name { font-weight: 700; font-size: 1.05rem; color: #202124; }
        
        /* ç¬¬äºŒè¡Œï¼šç±»å‹ + æŠ—æ€§ (èƒ¶å›Šæ ·å¼) */
        .row-props { display: flex; flex-wrap: wrap; gap: 6px; align-items: center; }
        .pill { 
            padding: 1px 8px; border-radius: 12px; font-size: 0.75rem; font-weight: 500; border: 1px solid transparent;
        }
        .pill-type { background: #e3f2fd; color: #174ea6; border-color: #d2e3fc; }
        .pill-res { background: #fce8e6; color: #c5221f; border-color: #fad2cf; }
        
        /* ç¬¬ä¸‰è¡Œï¼šç‰¹å¾ + å¤‡æ³¨ (æ–‡æœ¬æè¿°) */
        .row-desc { font-size: 0.85rem; color: #3c4043; line-height: 1.4; display: flex; flex-direction: column; gap: 2px; }
        .desc-line { display: flex; align-items: flex-start; gap: 6px; }
        .icon { opacity: 0.7; font-size: 0.9rem; min-width: 16px; }

        /* ç¬¬å››è¡Œï¼šæ“ä½œäºº + æ—¥æœŸ (åº•éƒ¨å…ƒæ•°æ®) */
        .row-meta { 
            font-size: 0.75rem; color: #70757a; 
            margin-top: 4px; padding-top: 8px; 
            border-top: 1px solid #f1f3f4;
            display: flex; gap: 12px;
        }

        /* çŠ¶æ€æ ‡è®° */
        .status-badge { font-size: 0.75rem; padding: 2px 8px; border-radius: 4px; font-weight: bold; }
        .st-out { background: #fef7e0; color: #b06000; border: 1px solid #fce8b2; }
        .st-del { background: #f1f3f4; color: #5f6368; border: 1px solid #dadce0; }

        /* é¢œè‰²å®šä¹‰ */
        .type-DNA { color: #1967D2; }
        #loading { text-align: center; padding: 40px; color: #666; }
        .error { color: #D93025; text-align: center; padding: 20px; word-break: break-all; }
    </style>
</head>
<body>

<div class="container">
    <div id="loading">æ­£åœ¨è§£ç æ•°æ®...</div>
    <div id="error-msg" class="error" style="display:none;"></div>

    <div id="app" style="display:none;">
        <div class="card header">
            <h1 id="box-name">ğŸ“¦ Unknown Box</h1>
            <div class="meta">
                <span id="box-size"></span> &nbsp;â€¢&nbsp; <span id="box-usage"></span>
            </div>
            <div class="stat-bar"><div class="stat-fill" id="stat-fill"></div></div>
        </div>

        <div class="list-title">Detailed List</div>
        <div id="list-container"></div>
    </div>
</div>

<script>
    function parseData() {
        try {
            const hash = window.location.hash;
            if (!hash || hash.length < 2) throw new Error("No data in Hash (#)");
            const rawData = hash.substring(1);
            let base64 = rawData.replace(/-/g, '+').replace(/_/g, '/');
            while (base64.length % 4) base64 += '=';
            const jsonStr = decodeURIComponent(Array.prototype.map.call(atob(base64), function(c) {
                return '%' + ('00' + c.charCodeAt(0).toString(16)).slice(-2);
            }).join(''));
            renderApp(JSON.parse(jsonStr));
        } catch (e) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('error-msg').style.display = 'block';
            document.getElementById('error-msg').innerHTML = "âŒ æ•°æ®åŠ è½½å¤±è´¥<br><small>" + e.message + "</small>";
        }
    }

    function renderApp(data) {
        document.getElementById('loading').style.display = 'none';
        document.getElementById('app').style.display = 'block';

        // 1. åŸºç¡€ä¿¡æ¯
        document.getElementById('box-name').innerText = "ğŸ“¦ " + data.n;
        const [rows, cols] = data.s.split('x').map(Number);
        const used = data.d.length;
        const percent = Math.round((used / (rows*cols)) * 100);

        document.getElementById('box-size').innerText = `ID: ${data.s}`; // è¿™é‡Œ data.s æ˜¯å°ºå¯¸
        document.getElementById('box-usage').innerText = `å·²ç”¨: ${used}/${rows*cols} (${percent}%)`;
        document.getElementById('stat-fill').style.width = percent + "%";

        // 2. åˆ—è¡¨æ¸²æŸ“ (ä¸¥æ ¼æŒ‰ç…§ A1, A2... é¡ºåº)
        const list = document.getElementById('list-container');
        
        // æ’åºï¼šå…ˆæŒ‰è¡Œ(r)ä»å°åˆ°å¤§ï¼Œå†æŒ‰åˆ—(c)ä»å°åˆ°å¤§
        data.d.sort((a,b) => (a[0] - b[0]) || (a[1] - b[1]));
        
        data.d.forEach(item => {
            // æ•°æ®è§£æ„ (ä¸ main_window.py å¯¹åº”)
            // 0:r, 1:c, 2:name, 3:type, 4:status, 5:feat, 6:res, 7:op, 8:date, 9:desc
            const [r, c, name, type, status, feat, res, op, date, desc] = item;
            
            // è®¡ç®—åæ ‡ A1, A2...
            const coord = String.fromCharCode(65+r) + (c+1);
            
            const div = document.createElement('div');
            div.className = 'list-item';

            // çŠ¶æ€å¾½ç« 
            let statusHtml = "";
            if (status === 1) statusHtml = `<span class="status-badge st-out">OUT</span>`;
            if (status === 2) statusHtml = `<span class="status-badge st-del">DEL</span>`;

            // æ„å»ºå†…éƒ¨ HTML (åˆ†è¡Œç»“æ„)
            let html = `
                <div class="row-top">
                    <div>
                        <span class="coord-badge">${coord}</span>
                        <span class="sample-name">${name}</span>
                    </div>
                    ${statusHtml}
                </div>
                
                <div class="row-props">
                    <span class="pill pill-type">ğŸ§¬ ${type}</span>
                    ${res ? `<span class="pill pill-res">ğŸ’Š ${res}</span>` : ""}
                </div>
            `;

            // å¦‚æœæœ‰ç‰¹å¾æˆ–å¤‡æ³¨ï¼Œæ˜¾ç¤ºç¬¬ä¸‰è¡Œ
            if (feat || desc) {
                html += `<div class="row-desc">`;
                if(feat) html += `<div class="desc-line"><span class="icon">ğŸ“</span> <span>${feat}</span></div>`;
                if(desc) html += `<div class="desc-line"><span class="icon">â„¹ï¸</span> <span style="font-style:italic; color:#5f6368">${desc}</span></div>`;
                html += `</div>`;
            }

            // å¦‚æœæœ‰æ“ä½œäººæˆ–æ—¥æœŸï¼Œæ˜¾ç¤ºåº•éƒ¨å…ƒæ•°æ®è¡Œ
            if (op || date) {
                html += `<div class="row-meta">`;
                if(op) html += `<span>ğŸ‘¤ ${op}</span>`;
                if(date) html += `<span>ğŸ“… ${date}</span>`;
                html += `</div>`;
            }

            div.innerHTML = html;
            list.appendChild(div);
        });
    }

    parseData();
</script>
</body>
</html>
